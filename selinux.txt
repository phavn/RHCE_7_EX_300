##### SELINUX Notes #####

- SELinux uses mandatory access control (MAC)

	https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/chap-security-enhanced_linux-introduction

	https://www.digitalocean.com/community/tutorials/an-introduction-to-selinux-on-centos-7-part-1-basic-concepts
	https://www.digitalocean.com/community/tutorials/an-introduction-to-selinux-on-centos-7-part-2-files-and-processes


Security Enhanced Linux (SELinux) provides an additional layer of system security. SELinux fundamentally answers the question: "May <subject> do <action> to <object>", for example: 


- Install selinux troubleshooting tools: 
	# yum install -y setroubleshoot setroubleshoot-server setools

- Use matchpathcon command to help verify/troubleshoot context related problems. This command will look at the current context of a resource and compare it with what's listed under the SELinux context database. If different, it will suggest the change required.
	# matchpathcon -V /www/html/index.html

- List all available selinux context types
	# seinfo -t

- Change file/dir context temporarily

	# chcon --type <context> <path> i.e. chcon --type httpd_sys_content_t /var/www/html/index.html

- Restore context using context database
	# restorecon <path>

- Selinux context are listed in:
	# cat /etc/selinux/targeted/contexts/files/file_contexts


# Steps to label /www and /www/html permanently:

	Note: run command below for examples:
	
		# man semanage-fcontext

	1. Use semanage fcontext command. This will write the new context to the /etc/selinux/targeted/contexts/files/file_contexts.local file. But it won't relabel the files/directories themselves.

		# semanage fcontext --add --type httpd_sys_content_t "/www(/.*)?"
		# semanage fcontext --add --type httpd_sys_content_t "/www/html(/.*)?"

	2. Check local contexts file for new entries

		# cat /etc/selinux/targeted/contexts/files/file_contexts.local

			# This file is auto-generated by libsemanage
			# Do not edit directly.

			/www(/.*)?    system_u:object_r:httpd_sys_content_t:s0
			/www/html(/.*)?    system_u:object_r:httpd_sys_content_t:s0			

	3. Relabel /www and /www/html by running restorecon command

		# restorecon -Rv /www


# Change http port to 888/tcp

	- change "Listen" directive of http.conf to 888

	- List all current port context

		# selinux port -l

	- Add port 888 as http port to selinux

		# selinux port -a -t http_port_t -p tcp 888

	- Firewall

		# firewall-cmd --permanent --add-port=888/tcp
		# firewall-cmd --reload


- List local file context database
	# semanage fcontext -l

- List all available selinux context types
	# seinfo -t

- Relabel filesystem on boot
	# touch /.autorelabel

- List all SELinux booleans
	# getsebool -a

- Set SELinux boolean
	# setsebool -P dhcpd_disable_trans=0

